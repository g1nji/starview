<?xml version="1.0" encoding="UTF-8"?>
<!-- 마이바티스 3 Mapper DTD -->
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="hyeri.dao.face.GalleryDao">

	<select id="selectCntAll" resultType="int">
		SELECT count(*) FROM gallery
	</select>
	
	<select id="selectList" resultType="hyeri.dto.Gallery" parameterType="hyeri.util.Paging">
		SELECT * FROM (
			SELECT rownum rnum, G.* FROM (
				SELECT
					gallery_no, gallery_title, gallery_content,
					gallery_date, gallery_hit
					, gallery_like
<!-- 					user_id,  -->
				FROM gallery
				ORDER BY gallery_no DESC
			) G
		) GALLERY
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	
	<select id="selectListFile" resultType="hyeri.dto.GalleryFile" parameterType="hyeri.util.Paging">
		SELECT * FROM (
			SELECT rownum rnum, G.* FROM (
				SELECT
					photo_no, gallery_no, stored_name, origin_name
				FROM gallery_file
				ORDER BY photo_no DESC
			) G
		) GALLERY_FILE
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	
	<update id="updateHit" parameterType="hyeri.dto.Gallery">
		UPDATE gallery
		SET gallery_hit = gallery_hit + 1
		WHERE gallery_no = #{galleryNo}
	</update>
	
	<select id="selectGallery" resultType="hyeri.dto.Gallery" parameterType="hyeri.dto.Gallery">
		SELECT
			gallery_no, gallery_title, gallery_content
		FROM gallery
		WHERE gallery_no = #{galleryNo}
	</select>

	<insert id="uploadPhoto" parameterType="hyeri.dto.Gallery">
		<selectKey order="BEFORE" resultType="int" keyProperty="galleryNo">
			SELECT gallery_seq.nextval FROM dual
		</selectKey>
		INSERT INTO gallery ( 
			gallery_no, gallery_title, gallery_content
<!-- 			, user_id -->
			)
		VALUES ( #{galleryNo}, #{galleryTitle }, #{galleryContent } )
	</insert>
	
	<insert id="insertPhoto" parameterType="hyeri.dto.GalleryFile">
		<selectKey order="BEFORE" resultType="int" keyProperty="photoNo">
			SELECT gallery_file_seq.nextval FROM dual
		</selectKey>
		INSERT INTO gallery_file ( photo_no, gallery_no, stored_name, origin_name )
		VALUES ( #{photoNo }, #{galleryNo }, #{storedName }, #{originName })
	</insert>

	<select id="selectGalleryFileByGalleryNo" resultType="hyeri.dto.GalleryFile" parameterType="hyeri.dto.Gallery">
		SELECT 
			photo_no, gallery_no, stored_name, origin_name
		FROM gallery_file
		WHERE gallery_no = #{galleryNo }
	</select>
	
	<update id="updatePhoto" parameterType="hyeri.dto.Gallery">
		UPDATE gallery
		SET gallery_title = #{galleryTitle }
			, gallery_content = #{galleryContent }
		WHERE gallery_no = #{galleryNo }
	</update>
	
	<delete id="deleteFile" parameterType="hyeri.dto.GalleryFile">
		DELETE gallery_file
		WHERE gallery_no = #{galleryNo }
	</delete>
	
	<delete id="delete" parameterType="hyeri.dto.Gallery">
		DELETE gallery
		WHERE gallery_no = #{galleryNo }
	</delete>
	
	<insert id="insertTag" parameterType="hyeri.dto.GTag">
		INSERT INTO g_tag ( tag_no, tag_name )
		VALUES ( g_tag_seq.nextval, #{tagName } )
	</insert>

</mapper>